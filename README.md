This code works on Cstar. 
Change to sequential execution by changing forall loops to for loops.
Next step will be to convert to CUDA.
